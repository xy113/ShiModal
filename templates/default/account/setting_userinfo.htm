{template header}
<div class="toolbar">
	<ul class="tab">
    	<li class="on"><a href="/?m=$G[m]&c=$G[c]&a=userinfo">基本信息</a></li>
        <li><a href="/?m=$G[m]&c=$G[c]&a=modiinfo">修改资料</a></li>
        <li><a href="/?m=$G[m]&c=$G[c]&a=security">账户安全</a></li>
        <li><a href="/?m=$G[m]&c=$G[c]&a=address">收货地址</a></li>
    </ul>
    
</div>
<div id="userinfo-table-wrap">
	<table width="100%" cellpadding="0" cellspacing="0" border="0" class="formtable">
    	<tbody>
        	<tr>
            	<td width="100">用户名</td>
                <td width="340">$userinfo[username]</td>
                <td></td>
            </tr>
            <tr>
            	<td>手　机</td>
                {if $userinfo[mobile]}
                <td>$userinfo[mobile]</td>
                <td><a class="a-bind-link" id="a-bind-mobile">更换手机号</a></td>
                {else}
                <td>没有绑定手机号</td>
                <td><a class="a-bind-link" id="a-bind-mobile">绑定手机号</a></td>
                {/if}
            </tr>
            <tr>
            	<td>邮　箱</td>
                {if $userinfo[email]}
                <td>{$userinfo[email]}</td>
                <td><a class="a-bind-link" id="a-bind-email">更换邮箱</a></td>
                {else}
                <td>没有绑定邮箱</td>
                <td><a class="a-bind-link" id="a-bind-email">定新邮箱</a></td>
                {/if}
            </tr>
            <tr>
            	<td>密　码</td>
                <td>******</td>
                <td><a class="a-bind-link" id="a-modi-password">修改密码</a></td>
            </tr>
        </tbody>
    </table>
</div>

<script type="text/x-template" id="J-bind-mobile-tpl">
<form method="post" id="J-bind-mobile-form" action="/?m=$G[m]&c=$G[c]&a=bindmobile">
	<input type="hidden" name="formsubmit" value="yes">
	<input type="hidden" name="formhash" value="{FORMHASH}">
  	<table width="100%" cellpadding="0" cellspacing="0" border="0" class="formtable">
	  <tbody>
		  <tr>
			  <td width="60">手机号</td>
			  <td width="220"><input type="text" class="input-text" name="mobile" maxlength="11" required="true" regular="/^1[3|5|8]\d{9}$/" error="$lang[mobile_incorrect]"></td>
			  <td>输入11位手机号</td>
		  </tr>
		  <tr>
			  <td>验证码</td>
			  <td>
				  <input type="text" class="input-text" name="captchacode" maxlength="4" required="true" regular="/^[\S]{4}$/" error="$lang[captchacode_incorrect]" style="width:120px;">
				  <img src="/?m=common&c=captcha" id="J-captcha" style="vertical-align:middle; height:28px; width:75px;">
			  </td>
			  <td><a onclick="document.getElementById('J-captcha').src='/?m=common&c=captcha&t='+Math.random()">更换验证码</a></td>
		  </tr>
		  <tr>
			  <td></td>
			  <td><button type="button" class="button" id="J-bind-button">绑定</button></td>
			  <td></td>
		  </tr>
	  </tbody>
  </table>
</form>
</script>
<script type="text/x-template" id="J-bind-email-tpl">
<form method="post" id="J-bind-email-form" action="/?m=$G[m]&c=$G[c]&a=bindemail">
	<input type="hidden" name="formsubmit" value="yes">
	<input type="hidden" name="formhash" value="{FORMHASH}">
  	<table width="100%" cellpadding="0" cellspacing="0" border="0" class="formtable">
	  <tbody>
		  <tr>
			  <td width="60">邮　箱</td>
			  <td width="220"><input type="text" class="input-text" name="email"></td>
			  <td>请输入邮箱</td>
		  </tr>
		  <tr>
			  <td>验证码</td>
			  <td>
				  <input type="text" class="input-text" name="captchacode" style="width:120px;">
				  <img src="/?m=common&c=captcha" id="J-captcha" style="vertical-align:middle; height:28px; width:75px;">
			  </td>
			  <td><a onclick="document.getElementById('J-captcha').src='/?m=common&c=captcha&t='+Math.random()">更换验证码</a></td>
		  </tr>
		  <tr>
			  <td></td>
			  <td><button type="button" class="button" id="J-bind-button">绑定</button></td>
			  <td></td>
		  </tr>
	  </tbody>
  </table>
</form>
</script>
<script type="text/x-template" id="J-modi-password-tpl">
<form method="post" id="J-modi-password-form" action="/?m=$G[m]&c=$G[c]&a=password">
	<input type="hidden" name="formsubmit" value="yes">
	<input type="hidden" name="formhash" value="{FORMHASH}">
  	<table width="100%" cellpadding="0" cellspacing="0" border="0" class="formtable">
	  <tbody>
		  <tr>
			  <td width="60">原密码</td>
			  <td width="220"><input type="password" class="input-text" name="password" required="true" regular="/^1[3|5|8]\d{9}$/" prompt="请输入原密码" error="{$lang[password_incorrect]}"></td>
			  <td>请输入原密码</td>
		  </tr>
		  <tr>
			  <td width="60">新密码</td>
			  <td><input type="password" class="input-text" name="newpassword"></td>
			  <td>请输入新密码，6-60位之间</td>
		  </tr>
		  <tr>
			  <td>验证码</td>
			  <td>
				  <input type="text" class="input-text" name="captchacode" style="width:120px;">
				  <img src="/?m=common&c=captcha" id="J-captcha" style="vertical-align:middle; height:28px; width:75px;">
			  </td>
			  <td><a onclick="document.getElementById('J-captcha').src='/?m=common&c=captcha&t='+Math.random()">更换验证码</a></td>
		  </tr>
		  <tr>
			  <td></td>
			  <td><button type="button" class="button" id="J-bind-button">绑定</button></td>
			  <td></td>
		  </tr>
	  </tbody>
  </table>
</form>
</script>
<script type="text/javascript">
$("#a-bind-mobile").click(function(e) {
	var c = $("#J-bind-mobile-tpl").html();
    var dlg = dialog(c,{title:'绑定手机号',width:'450',
		afterShow:function(){
			var form = $("#J-bind-mobile-form");
			form.validate({
				submitType:'ajax',
				submitButton:'#J-bind-button',
				settings:{
					dataType:'json',
					success:function(json){
						if(json.errno == 0){
							dlg.close();
							DSXUI.success('绑定成功', DSXUtil.reFresh);
						}else {
							DSXUI.error(json.error);
							$("#J-captcha").attr("src","/?m=common&c=captcha&t="+Math.random());
						}
					}
				}
			});
		},
		afterClose:function(){
			$(".ui-form-tips").remove();
		}
	});
});
$("#a-bind-email").click(function(e) {
    var c = $("#J-bind-email-tpl").html();
    var dlg = dialog(c,{title:'绑定邮箱',width:'450',
		afterShow:function(){
			var form = $("#J-bind-email-form");
			$("#J-bind-button").click(function(e) {
                var email = form.find("[name=email]").val();
				if(!DSXUtil.IsEmail(email)) {
					DSXUI.error('{$lang[email_incorrect]}');
					return false;
				}
				var captchacode = form.find("[name=captchacode]").val();
				if(captchacode.length != 4){
					DSXUI.error('{$lang[captchacode_incorrect]}');
					return false;
				}
				form.ajaxSubmit({
					dataType:'json',
					success:function(json){
						if(json.errno == 0){
							dlg.close();
							DSXUI.success('绑定成功', DSXUtil.reFresh);
						}else {
							DSXUI.error(json.error);
							$("#J-captcha").attr("src","/?m=common&c=captcha&t="+Math.random());
						}
					}
				});
            });
		}
	});
});
$("#a-modi-password").click(function(e) {
    var c = $("#J-modi-password-tpl").html();
    var dlg = dialog(c,{title:'修改密码',width:'450',
		afterShow:function(){
			var form = $("#J-modi-password-form");
			$("#J-bind-button").click(function(e) {
                var password = form.find("[name=password]").val();
				if(!DSXUtil.IsPassword(password)) {
					DSXUI.error('{$lang[password_incorrect]}');
					return false;
				}
				var newpassword = form.find("[name=newpassword]").val();
				if(!DSXUtil.IsPassword(newpassword)) {
					DSXUI.error('{$lang[password_incorrect]}');
					return false;
				}
				var captchacode = form.find("[name=captchacode]").val();
				if(captchacode.length != 4){
					DSXUI.error('{$lang[captchacode_incorrect]}');
					return false;
				}
				form.ajaxSubmit({
					dataType:'json',
					success:function(json){
						if(json.errno == 0){
							dlg.close();
							DSXUI.success('修改成功', DSXUtil.reFresh);
						}else {
							DSXUI.error(json.error);
							$("#J-captcha").attr("src","/?m=common&c=captcha&t="+Math.random());
						}
					}
				});
            });
		}
	});
});
</script>
{template footer}